<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Mini-WTD ¬∑ Webcam & observation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description"
        content="Mini-WTD ‚Äî module webcam de d√©monstration : observer une posture, v√©rifier l‚Äô√©clairage et ouvrir le dialogue sur l‚Äôam√©nagement de poste.">

  <!-- Styles globaux -->
  <link rel="stylesheet" href="assets/css/mini-wtd-2025.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/base-a11y.css">
  <link rel="stylesheet" href="assets/css/rgaa-accessible.css">
</head>

<body>
<a href="#main" class="skiplink">Aller directement au contenu</a>

<!-- ===== HEADER ===== -->
<header class="site-header" role="banner">
  <div class="container site-header-inner">
    <div class="site-brand">
      <div class="site-logo">
        <img src="assets/ima/logo-mini-wtd-256.png" alt="Logo Mini-WTD" loading="lazy">
      </div>
      <div class="site-brand-text">
        <h1 class="site-title">Mini-WTD</h1>
        <p class="site-tagline">Work-Test-Demo ¬∑ Module webcam (d√©mo)</p>
      </div>
    </div>

    <div class="a11y-toolbar" aria-label="R√©glages d‚Äôaccessibilit√© et de lecture">
      <button class="access-btn" data-action="font-" type="button">A‚àí</button>
      <button class="access-btn" data-action="font+" type="button">A+</button>
      <button class="access-btn" data-action="contrast" type="button">‚óê</button>
      <button class="access-btn" data-action="spacing" type="button">‚ÜïÔ∏é</button>
      <button class="access-btn" data-action="reset" type="button">‚ü≤</button>
      <button id="theme-toggle" class="btn-icon" type="button">üåì</button>
      <button id="tts-toggle" class="btn-icon" type="button">üîä</button>
    </div>
  </div>

  <div class="container site-nav-toggle">
    <button
      id="menu-toggle"
      class="btn-icon"
      type="button"
      aria-label="Ouvrir ou fermer le menu"
      aria-expanded="false"
      aria-controls="primary-nav">
      <span class="burger" aria-hidden="true"></span>
      <span class="sr-only">Menu</span>
    </button>
  </div>

  <nav class="site-nav" aria-label="Navigation principale">
    <ul id="primary-nav">
      <li><a href="index.html">Accueil</a></li>
      <li><a href="presentation.html">Pr√©sentation</a></li>
      <li><a href="assistant.html">Assistant IA</a></li>
      <li><a href="evaluation-amenagement.html">Bilan</a></li>
      <li><a href="webcam-analyse.html" class="active" aria-current="page">Webcam</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>
</header>

<!-- ===== CONTENU ===== -->
<main id="main" class="container" role="main" tabindex="-1">

  <!-- Hero -->
  <section class="hero">
    <h2>Module webcam ¬∑ observation ergonomique (d√©mo)</h2>
    <p class="mwtd-lead">
      Ce module permet de <strong>visualiser une posture</strong> via la webcam et de
      lancer une discussion sur l‚Äôam√©nagement de poste : hauteur d‚Äô√©cran,
      √©clairage, distance, organisation de l‚Äôespace.
    </p>
    <p>
      <strong>Version 1</strong> : d√©mo simple, 100&nbsp;% locale.
      Aucune image n‚Äôest enregistr√©e ni envoy√©e sur Internet.
      Les r√©sultats sont indicatifs et doivent toujours √™tre compl√©t√©s par
      l‚Äôobservation humaine et l‚Äô√©change avec la personne.
    </p>
  </section>

  <!-- Ce que fait / ne fait pas -->
  <section class="cards-grid" aria-label="Limites et objectifs du module">
    <article class="card">
      <h3>Ce que fait ce module</h3>
      <ul>
        <li>Affiche l‚Äôimage de la webcam sur l‚Äô√©cran.</li>
        <li>Donne un retour rapide sur l‚Äô√©clairage de la sc√®ne.</li>
        <li>Propose une synth√®se textuelle d‚Äôobservation.</li>
        <li>Ouvre un dialogue sur les pistes d‚Äôam√©nagement.</li>
      </ul>
    </article>

    <article class="card">
      <h3>Ce qu‚Äôil ne fait pas</h3>
      <ul>
        <li>Pas de diagnostic m√©dical, ni d‚Äôavis de sant√©.</li>
        <li>Pas de reconnaissance faciale, pas d‚Äôidentification.</li>
        <li>Pas de stockage ni d‚Äôenvoi des images.</li>
        <li>Pas de d√©cision automatique sur l‚Äôaptitude.</li>
      </ul>
    </article>
  </section>

  <!-- Bloc webcam -->
  <section class="mwtd-panel" aria-labelledby="webcam-title">
    <header class="mwtd-card-header">
      <div>
        <h2 id="webcam-title" class="mwtd-card-title">Observation en direct via webcam</h2>
        <p class="mwtd-card-subtitle">
          Utilisation recommand√©e en <strong>pr√©sence de la personne</strong>, avec son accord explicite.
        </p>
      </div>
    </header>

    <div class="mwtd-grid" style="margin-top:1rem;">
      <!-- Colonne gauche : vid√©o -->
      <div class="mwtd-card">
        <h3>Vue cam√©ra</h3>
        <p class="form-hint">
          Cliquez sur ‚ÄúActiver la webcam‚Äù et autorisez l‚Äôacc√®s √† la cam√©ra.
        </p>

        <div class="mwtd-webcam-shell">
          <div class="mwtd-webcam-video-wrap">
            <video id="mwtd-video"
                   playsinline
                   autoplay
                   muted
                   aria-label="Flux vid√©o de la webcam (aucun enregistrement)">
            </video>
            <div id="mwtd-video-overlay" class="mwtd-webcam-overlay" aria-hidden="true">
              <p>En attente d‚Äôautorisation‚Ä¶</p>
            </div>
          </div>

          <div class="mwtd-row" style="margin-top:0.75rem;">
            <button id="mwtd-start" type="button" class="btn btn-primary">
              Activer la webcam
            </button>
            <button id="mwtd-stop" type="button" class="btn" disabled>
              Arr√™ter
            </button>
            <button id="mwtd-analyse" type="button" class="btn" disabled>
              Analyser l‚Äôimage (d√©mo)
            </button>
          </div>

          <p id="mwtd-webcam-status"
             class="form-hint"
             aria-live="polite"
             style="margin-top:0.5rem;">
            Statut : en attente.
          </p>
        </div>

        <!-- Canvas cach√© pour l‚Äôanalyse de luminosit√© -->
        <canvas id="mwtd-canvas" width="320" height="240" hidden></canvas>
      </div>

      <!-- Colonne droite : r√©sultats -->
      <div class="mwtd-card">
        <h3>Retour rapide sur l‚Äôenvironnement</h3>

        <dl class="mwtd-observe-list" aria-live="polite">
          <div class="mwtd-observe-item">
            <dt>Lumi√®re &amp; contraste</dt>
            <dd id="mwtd-result-light">En attente d‚Äôanalyse.</dd>
          </div>
          <div class="mwtd-observe-item">
            <dt>Distance √©cran / personne</dt>
            <dd id="mwtd-result-distance">
              √Ä √©valuer avec la personne (d√©mo : rappel des bonnes pratiques).
            </dd>
          </div>
          <div class="mwtd-observe-item">
            <dt>Posture g√©n√©rale</dt>
            <dd id="mwtd-result-posture">
              V√©rifier hauteur d‚Äô√©cran, position de la chaise, appui des pieds.
            </dd>
          </div>
        </dl>

        <div class="mwtd-observer-notes">
          <label for="mwtd-notes">
            Notes d‚Äôobservation (facultatif)
          </label>
          <textarea id="mwtd-notes" rows="4"
                    placeholder="Exemples : √©cran trop haut, reflet sur l‚Äô√©cran, besoin d‚Äôappui pour les avant-bras‚Ä¶"></textarea>
          <p class="form-hint">
            Vous pouvez copier-coller ces notes dans le bilan d‚Äôam√©nagement.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Mode d‚Äôemploi -->
  <section class="mwtd-panel" aria-labelledby="mode-usage-title">
    <header class="mwtd-card-header">
      <div>
        <h2 id="mode-usage-title" class="mwtd-card-title">Comment utiliser ce module en entretien&nbsp;?</h2>
        <p class="mwtd-card-subtitle">
          Quelques rep√®res pour un usage √©thique, simple et respectueux.
        </p>
      </div>
    </header>

    <ol class="mwtd-list-steps">
      <li><strong>Demander l‚Äôaccord</strong> de la personne avant d‚Äôactiver la webcam.</li>
      <li>Positionner la cam√©ra de fa√ßon √† voir le buste, l‚Äô√©cran et la zone de travail.</li>
      <li>Lancer l‚Äôanalyse (d√©mo) pour obtenir un retour sur la lumi√®re.</li>
      <li>Compl√©ter par l‚Äôobservation : hauteur de l‚Äô√©cran, distances, gestes, appuis.</li>
      <li>Noter les pistes d‚Äôam√©nagement et les int√©grer au <a href="evaluation-amenagement.html">bilan</a>.</li>
    </ol>

    <p class="form-hint">
      Version 1 : analyse l√©g√®re, uniquement sur la luminosit√© de la sc√®ne.  
      Version 2 (optionnelle) pourra int√©grer une analyse IA plus pouss√©e (posture) c√¥t√© entreprise,
      dans un cadre technique et juridique renforc√©.
    </p>
  </section>
</main>

<!-- ===== FOOTER ===== -->
<footer class="site-footer" role="contentinfo">
  <div class="container">
    <p>¬© 2025 ¬∑ Mini-WTD ‚Äî Module webcam de d√©monstration, sans enregistrement d‚Äôimages.</p>
  </div>
</footer>

<!-- ===== SCRIPTS ===== -->
<script>
(function () {
  const video   = document.getElementById('mwtd-video');
  const canvas  = document.getElementById('mwtd-canvas');
  const overlay = document.getElementById('mwtd-video-overlay');
  const btnStart   = document.getElementById('mwtd-start');
  const btnStop    = document.getElementById('mwtd-stop');
  const btnAnalyse = document.getElementById('mwtd-analyse');
  const statusEl   = document.getElementById('mwtd-webcam-status');

  const lightEl    = document.getElementById('mwtd-result-light');
  const distEl     = document.getElementById('mwtd-result-distance');
  const postureEl  = document.getElementById('mwtd-result-posture');

  let stream = null;

  function setStatus(msg) {
    if (statusEl) statusEl.textContent = 'Statut : ' + msg;
  }

  async function startWebcam() {
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      setStatus("Webcam non support√©e par ce navigateur.");
      return;
    }
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
      video.srcObject = stream;
      if (overlay) overlay.innerHTML = "<p>Webcam active (d√©mo).</p>";
      btnStop.disabled = false;
      btnAnalyse.disabled = false;
      setStatus("webcam active.");
    } catch (err) {
      console.error(err);
      setStatus("acc√®s refus√© ou impossible.");
      if (overlay) overlay.innerHTML =
        "<p>Acc√®s √† la webcam refus√© ou impossible.</p>";
    }
  }

  function stopWebcam() {
    if (stream) {
      stream.getTracks().forEach(t => t.stop());
      stream = null;
    }
    video.srcObject = null;
    if (overlay) overlay.innerHTML = "<p>Webcam arr√™t√©e.</p>";
    btnStop.disabled = true;
    btnAnalyse.disabled = true;
    setStatus("webcam arr√™t√©e.");
  }

  function analyseFrame() {
    if (!stream || !video.videoWidth || !video.videoHeight) {
      setStatus("aucune image √† analyser.");
      return;
    }

    const ctx = canvas.getContext('2d');
    const w = canvas.width;
    const h = canvas.height;

    // Dessine une version r√©duite de l‚Äôimage pour analyse rapide
    ctx.drawImage(video, 0, 0, w, h);
    const data = ctx.getImageData(0, 0, w, h).data;

    let sum = 0;
    // Moyenne de luminosit√© simple (0-255)
    for (let i = 0; i < data.length; i += 4) {
      const r = data[i];
      const g = data[i + 1];
      const b = data[i + 2];
      const lum = 0.299 * r + 0.587 * g + 0.114 * b;
      sum += lum;
    }
    const avg = sum / (data.length / 4);

    let msgLight;
    if (avg < 60) {
      msgLight = "√âclairage tr√®s faible : risque de fatigue visuelle, pensez √† ajouter une source de lumi√®re douce.";
    } else if (avg < 120) {
      msgLight = "√âclairage plut√¥t faible : v√©rifier que le visage et le plan de travail sont bien visibles.";
    } else if (avg > 210) {
      msgLight = "√âclairage tr√®s fort : surveiller les reflets et l‚Äô√©blouissement sur l‚Äô√©cran.";
    } else {
      msgLight = "√âclairage globalement correct pour l‚Äô√©cran et le visage (√† valider avec la personne).";
    }
    lightEl.textContent = msgLight;

    distEl.textContent =
      "En d√©mo, la distance n‚Äôest pas mesur√©e automatiquement. " +
      "V√©rifier que la personne peut tendre l√©g√®rement les bras pour toucher l‚Äô√©cran sans effort, " +
      "et que le haut de l‚Äô√©cran est √† hauteur des yeux ou l√©g√®rement en dessous.";

    postureEl.textContent =
      "Observer : appui des pieds au sol, dos soutenu, √©paules rel√¢ch√©es, avant-bras appuy√©s. " +
      "Adapter la hauteur de la chaise et de l‚Äô√©cran si n√©cessaire.";

    setStatus("analyse simple effectu√©e (d√©mo).");
  }

  if (btnStart)   btnStart.addEventListener('click', startWebcam);
  if (btnStop)    btnStop.addEventListener('click', stopWebcam);
  if (btnAnalyse) btnAnalyse.addEventListener('click', analyseFrame);

  // Arr√™t s√©curitaire si on quitte la page
  window.addEventListener('beforeunload', stopWebcam);
})();
</script>

<script src="assets/js/mwtd-menu.js"></script>
<script src="assets/js/mwtd-accessibility.js"></script>
<script src="assets/js/mwtd-theme.js"></script>
<script src="assets/js/mwtd-tts.js"></script>
</body>
</html>

