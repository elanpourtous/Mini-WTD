<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Mini-WTD ¬∑ Bilan d‚Äôam√©nagement</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description"
        content="Mini-WTD ‚Äî Bilan d‚Äôam√©nagement de poste : description de la situation, contraintes, impacts et pistes d‚Äôadaptation.">

  <!-- Styles globaux -->
  <link rel="stylesheet" href="assets/css/mini-wtd-2025.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/base-a11y.css">
  <link rel="stylesheet" href="assets/css/rgaa-accessible.css">
</head>

<body class="bilan-page">
  <a href="#main" class="skiplink">Aller directement au contenu</a>

  <!-- ===== HEADER ===== -->
  <header class="site-header" role="banner">
    <div class="container site-header-inner">
      <div class="site-brand">
        <div class="site-logo">
          <img src="assets/ima/logo-mini-wtd-256.png" alt="Logo Mini-WTD" loading="lazy">
        </div>
        <div class="site-brand-text">
          <h1 class="site-title">Mini-WTD</h1>
          <p class="site-tagline">Work-Test-Demo ¬∑ Bilan d‚Äôam√©nagement</p>
        </div>
      </div>

      <div class="a11y-toolbar" aria-label="R√©glages d‚Äôaccessibilit√© et de lecture">
        <button class="access-btn" data-action="font-" type="button"
                aria-label="R√©duire la taille du texte" title="A‚àí (Alt + -)">A‚àí</button>
        <button class="access-btn" data-action="font+" type="button"
                aria-label="Augmenter la taille du texte" title="A+ (Alt + =)">A+</button>
        <button class="access-btn" data-action="contrast" type="button"
                aria-label="Activer le contraste √©lev√©" title="Contraste √©lev√© (Alt + C)">‚óê</button>
        <button class="access-btn" data-action="spacing" type="button"
                aria-label="Augmenter l‚Äôespacement du texte" title="Espacement (Alt + S)">‚ÜïÔ∏é</button>
        <button class="access-btn" data-action="reset" type="button"
                aria-label="R√©initialiser l‚Äôaffichage" title="R√©initialiser (Alt + 0)">‚ü≤</button>

        <button id="theme-toggle" class="btn-icon" type="button"
                aria-pressed="false"
                aria-label="Basculer le th√®me clair/sombre"
                title="Th√®me clair / sombre">üåì</button>

        <button id="tts-toggle" class="btn-icon" type="button"
                aria-pressed="false"
                aria-label="Activer la lecture vocale de la page"
                title="Lecture vocale">üîä</button>
      </div>
    </div>

    <div class="container site-nav-toggle">
      <button
        id="menu-toggle"
        class="btn-icon"
        type="button"
        aria-label="Ouvrir ou fermer le menu"
        aria-expanded="false"
        aria-controls="primary-nav">
        <span class="burger" aria-hidden="true"></span>
        <span class="sr-only">Menu</span>
      </button>
    </div>

    <nav class="site-nav" aria-label="Navigation principale">
      <ul id="primary-nav">
        <li><a href="index.html">Accueil</a></li>
        <li><a href="presentation.html">Pr√©sentation</a></li>
        <li><a href="assistant.html">Assistant IA</a></li>
        <li><a href="evaluation-amenagement.html" class="active" aria-current="page">Bilan</a></li>
        <li><a href="webcam-analyse.html">Webcam</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
  </header>

  <!-- ===== CONTENU ===== -->
  <main id="main" class="container" role="main" tabindex="-1">
    <section class="hero">
      <h2>Bilan d‚Äôam√©nagement de poste</h2>
      <p class="mwtd-lead">
        Cette page sert de support pour construire un <strong>bilan structur√©</strong> :
        situation de travail, contraintes, impacts, pistes d‚Äôam√©nagement et d√©cisions.
      </p>
      <p>
        Vous pouvez l‚Äôutiliser comme grille d‚Äôentretien, puis copier-coller le r√©sultat
        dans un document √† partager (RH, manager, r√©f√©rent handicap, m√©decine du travail).
      </p>
    </section>

    <section class="mwtd-panel" aria-labelledby="form-bilan-title">
      <header class="mwtd-card-header">
        <div>
          <h3 id="form-bilan-title" class="mwtd-card-title">Grille de bilan</h3>
          <p class="mwtd-card-subtitle">
            Aucun enregistrement automatique : ce que vous saisissez reste sur cet appareil.
          </p>
        </div>
      </header>

      <form class="mwtd-form" id="form-bilan" novalidate>
        <!-- 1. Identit√© / contexte -->
        <fieldset class="mwtd-fieldset">
          <legend>1. Contexte</legend>

          <div class="form-group">
            <label for="bilan-personne">Candidat / salari√©</label>
            <input id="bilan-personne" name="bilan-personne" type="text" autocomplete="off">
            <p class="form-hint">Nom ou identifiant interne (facultatif pour tests).</p>
          </div>

          <div class="form-group">
            <label for="bilan-poste">Poste de travail / fonction actuelle</label>
            <input id="bilan-poste" name="bilan-poste" type="text" autocomplete="off">
          </div>

          <div class="form-group">
            <label for="bilan-service">Service / site</label>
            <input id="bilan-service" name="bilan-service" type="text" autocomplete="off">
          </div>
        </fieldset>

        <!-- 2. Description de la situation -->
        <fieldset class="mwtd-fieldset">
          <legend>2. Description de la situation</legend>

          <div class="form-group">
            <label for="bilan-taches">T√¢ches principales du poste</label>
            <textarea id="bilan-taches" name="bilan-taches" rows="4"></textarea>
            <p class="form-hint">Exemples : accueil du public, saisie informatique, d√©placements sur site‚Ä¶</p>
          </div>

          <div class="form-group">
            <label for="bilan-difficultes">
              Difficult√©s rencontr√©es dans la situation actuelle
            </label>
            <textarea id="bilan-difficultes" name="bilan-difficultes" rows="4"></textarea>
            <p class="form-hint">
              Exemples : fatigue en station debout, difficult√©s √† utiliser un clavier ou un √©cran,
              d√©placements longs, bruit, lumi√®re‚Ä¶
            </p>
          </div>
        </fieldset>

        <!-- 3. Impacts & urgences -->
        <fieldset class="mwtd-fieldset">
          <legend>3. Impacts & urgences</legend>

          <div class="form-group">
            <label for="bilan-impacts">
              Impacts sur le travail, la sant√©, l‚Äô√©quipe, les usagers
            </label>
            <textarea id="bilan-impacts" name="bilan-impacts" rows="3"></textarea>
          </div>

          <div class="form-group">
            <label for="bilan-urgence">Niveau d‚Äôurgence per√ßu</label>
            <select id="bilan-urgence" name="bilan-urgence">
              <option value="">S√©lectionner‚Ä¶</option>
              <option value="imm√©diat">Imm√©diat : situation critique</option>
              <option value="prioritaire">Prioritaire : √† traiter dans les semaines √† venir</option>
              <option value="a-planifier">√Ä planifier : peut attendre un projet plus large</option>
            </select>
          </div>
        </fieldset>

        <!-- 4. Pistes d‚Äôam√©nagement -->
        <fieldset class="mwtd-fieldset">
          <legend>4. Pistes d‚Äôam√©nagement envisag√©es</legend>

          <div class="form-group">
            <label for="bilan-materiel">Am√©nagements mat√©riels</label>
            <textarea id="bilan-materiel" name="bilan-materiel" rows="3"></textarea>
            <p class="form-hint">Exemples : si√®ge adapt√©, repose-pieds, √©cran plus grand, outils de saisie‚Ä¶</p>
          </div>

          <div class="form-group">
            <label for="bilan-organisation">
              Am√©nagements organisationnels / horaires
            </label>
            <textarea id="bilan-organisation" name="bilan-organisation" rows="3"></textarea>
            <p class="form-hint">Exemples : t√©l√©travail partiel, pauses suppl√©mentaires, adaptation des horaires‚Ä¶</p>
          </div>

          <div class="form-group">
            <label for="bilan-numerique">
              Am√©nagements num√©riques / logiciels
            </label>
            <textarea id="bilan-numerique" name="bilan-numerique" rows="3"></textarea>
            <p class="form-hint">Exemples : lecteurs d‚Äô√©cran, zoom, param√©trage, simplification des interfaces‚Ä¶</p>
          </div>
        </fieldset>

        <!-- 5. Acteurs concern√©s / d√©cisions -->
        <fieldset class="mwtd-fieldset">
          <legend>5. Acteurs & d√©cisions</legend>

          <div class="form-group">
            <label for="bilan-acteurs">
              Acteurs √† associer (interne / externe)
            </label>
            <textarea id="bilan-acteurs" name="bilan-acteurs" rows="3"></textarea>
            <p class="form-hint">
              Exemples : manager, RH, r√©f√©rent handicap, m√©decine du travail, Agefiph, MDPH‚Ä¶
            </p>
          </div>

          <div class="form-group">
            <label for="bilan-decisions">
              D√©cisions / prochaines √©tapes
            </label>
            <textarea id="bilan-decisions" name="bilan-decisions" rows="3"></textarea>
            <p class="form-hint">
              Exemples : phase d‚Äôessai de 3 mois, achat de mat√©riel, demande de financement,
              nouvelle rencontre planifi√©e √† une date donn√©e.
            </p>
          </div>
        </fieldset>

        <!-- 6. R√©sum√© -->
        <fieldset class="mwtd-fieldset">
          <legend>6. R√©sum√© du bilan (brouillon)</legend>
          <div class="form-group">
            <label for="bilan-resume">
              R√©sum√© √† partager (copier-coller possible vers un document interne)
            </label>
            <textarea id="bilan-resume" name="bilan-resume" rows="6"></textarea>
            <p class="form-hint">
              Vous pouvez y coller un texte g√©n√©r√© par l‚Äôassistant IA, puis le modifier.
            </p>
          </div>
        </fieldset>

        <!-- 7. Envoi & export -->
        <fieldset class="mwtd-fieldset">
          <legend>7. Envoi & export</legend>

          <div class="form-group">
            <label for="bilan-email">Adresse e-mail pour recevoir le bilan</label>
            <input id="bilan-email"
                   name="bilan-email"
                   type="email"
                   autocomplete="email"
                   placeholder="exemple@entreprise.fr">
            <p class="form-hint">
              Le bilan sera envoy√© √† cette adresse sous forme de texte. Mini-WTD ne conserve pas vos donn√©es.
            </p>
          </div>

          <div class="form-group bilan-actions">
            <button type="button" class="btn" id="btn-export-word">
              T√©l√©charger le bilan en Word
            </button>
            <button type="button" class="btn btn-primary" id="btn-send-email">
              Envoyer le bilan par e-mail
            </button>
          </div>

          <p class="form-hint">
            L‚Äôenvoi par e-mail utilise un service externe configur√© par votre organisation (EmailJS).
            Les informations sont envoy√©es uniquement √† l‚Äôadresse indiqu√©e.
          </p>
        </fieldset>

        <p class="form-hint">
          Mini-WTD ne stocke pas vos donn√©es : pensez √† enregistrer ce bilan dans vos
          outils internes (SIRH, dossier RH, fichier s√©curis√©‚Ä¶).
        </p>

        <button type="submit" class="btn btn-secondary">
          Utilisation en d√©mo ‚Äî aucune donn√©e n‚Äôest envoy√©e
        </button>
      </form>
    </section>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="site-footer" role="contentinfo">
    <div class="container">
      <p>¬© 2025 ¬∑ Mini-WTD ‚Äî Bilan d‚Äôam√©nagement de poste.</p>
    </div>
  </footer>

  <!-- ===== EmailJS (service externe d'envoi d'e-mails) ===== -->
  <!-- 1) Cr√©e un compte sur https://www.emailjs.com/
       2) Cr√©e un service + un template
       3) Remplace EMAILJS_PUBLIC_KEY, EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID
          par tes vraies valeurs. -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <!-- ===== Scripts ===== -->
  <script>
    (function () {
      // --- Emp√™che l'envoi r√©el du formulaire (mode d√©mo) ---
      const form = document.getElementById('form-bilan');
      if (form) {
        form.addEventListener('submit', function (e) {
          e.preventDefault();
          alert(
            "Mode d√©mo : le formulaire n'est pas envoy√©.\n" +
            "Utilisez les boutons 'T√©l√©charger le bilan en Word' ou 'Envoyer le bilan par e-mail'."
          );
        });
      }
      
// --- Initialisation EmailJS (√† personnaliser) ---
if (window.emailjs) {
  emailjs.init("xsjJ22bXyvRFEXe38"); // ‚¨ÖÔ∏è ta cl√© publique
}
      }

      // --- R√©cup√©ration des donn√©es du formulaire ---
      function collectBilanData() {
        return {
          personne:   document.getElementById('bilan-personne')?.value.trim()   || "",
          poste:      document.getElementById('bilan-poste')?.value.trim()      || "",
          service:    document.getElementById('bilan-service')?.value.trim()    || "",
          taches:     document.getElementById('bilan-taches')?.value.trim()     || "",
          difficultes:document.getElementById('bilan-difficultes')?.value.trim()|| "",
          impacts:    document.getElementById('bilan-impacts')?.value.trim()    || "",
          urgence:    document.getElementById('bilan-urgence')?.value           || "",
          materiel:   document.getElementById('bilan-materiel')?.value.trim()   || "",
          organisation: document.getElementById('bilan-organisation')?.value.trim() || "",
          numerique:  document.getElementById('bilan-numerique')?.value.trim()  || "",
          acteurs:    document.getElementById('bilan-acteurs')?.value.trim()    || "",
          decisions:  document.getElementById('bilan-decisions')?.value.trim()  || "",
          resume:     document.getElementById('bilan-resume')?.value.trim()     || ""
        };
      }

      // --- Construction d'un texte simple pour l'e-mail ---
      function buildPlainTextSummary(data) {
        function v(x) { return x && x.length ? x : "Non renseign√©"; }

        let text = "";
        text += "Bilan d‚Äôam√©nagement de poste ‚Äì Mini-WTD\n";
        text += "=======================================\n\n";

        text += "1. Contexte\n";
        text += "- Candidat / salari√© : " + v(data.personne) + "\n";
        text += "- Poste de travail / fonction : " + v(data.poste) + "\n";
        text += "- Service / site : " + v(data.service) + "\n\n";

        text += "2. Description de la situation\n";
        text += "- T√¢ches principales :\n" + v(data.taches) + "\n\n";
        text += "- Difficult√©s rencontr√©es :\n" + v(data.difficultes) + "\n\n";

        text += "3. Impacts & urgences\n";
        text += "- Impacts :\n" + v(data.impacts) + "\n\n";
        text += "- Niveau d‚Äôurgence per√ßu : " + v(data.urgence) + "\n\n";

        text += "4. Pistes d‚Äôam√©nagement envisag√©es\n";
        text += "- Am√©nagements mat√©riels :\n" + v(data.materiel) + "\n\n";
        text += "- Am√©nagements organisationnels / horaires :\n" + v(data.organisation) + "\n\n";
        text += "- Am√©nagements num√©riques / logiciels :\n" + v(data.numerique) + "\n\n";

        text += "5. Acteurs & d√©cisions\n";
        text += "- Acteurs √† associer :\n" + v(data.acteurs) + "\n\n";
        text += "- D√©cisions / prochaines √©tapes :\n" + v(data.decisions) + "\n\n";

        text += "6. R√©sum√© du bilan (brouillon)\n";
        text += v(data.resume) + "\n";

        return text;
      }

      // --- HTML pour le fichier Word (doc bas√© sur HTML) ---
      function buildHtmlSummary(data) {
        const txt = buildPlainTextSummary(data)
          .replace(/\n/g, "<br>");

        return (
          "<!doctype html>" +
          "<html><head><meta charset='utf-8'>" +
          "<title>Bilan d‚Äôam√©nagement ‚Äì Mini-WTD</title></head>" +
          "<body>" +
          "<h1>Bilan d‚Äôam√©nagement de poste ‚Äì Mini-WTD</h1>" +
          "<p>" + txt + "</p>" +
          "</body></html>"
        );
      }

      // --- Export en Word (.doc) ---
      function exportToWord() {
        const data = collectBilanData();
        const html = buildHtmlSummary(data);
        const blob = new Blob(["\ufeff", html], { type: "application/msword" });
        const url  = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = "bilan-amenagement-mini-wtd.doc";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }

      // --- Envoi par e-mail via EmailJS ---
      function sendByEmail() {
        const emailInput = document.getElementById("bilan-email");
        const toEmail = emailInput ? emailInput.value.trim() : "";

        if (!toEmail) {
          alert("Merci de renseigner une adresse e-mail pour recevoir le bilan.");
          if (emailInput) emailInput.focus();
          return;
        }

        if (!window.emailjs) {
          alert("EmailJS n‚Äôest pas disponible. V√©rifiez la connexion ou la configuration du script EmailJS.");
          return;
        }

        const data = collectBilanData();
        const message = buildPlainTextSummary(data);

        // ‚ö†Ô∏è Remplacer par tes identifiants EmailJS
const SERVICE_ID  = "service_miniwtd";   // exemple, prends ton vrai ID
const TEMPLATE_ID = "template_tr7v61k";  // celui que tu viens de cr√©er


        const templateParams = {
          to_email: toEmail,
          message:  message,
          sujet:    "Bilan d‚Äôam√©nagement de poste ‚Äì Mini-WTD"
        };

        emailjs.send(SERVICE_ID, TEMPLATE_ID, templateParams)
          .then(function () {
            alert("Le bilan a √©t√© envoy√© √† l‚Äôadresse : " + toEmail);
          })
          .catch(function (error) {
            console.error("Erreur EmailJS :", error);
            alert(
              "L‚Äôenvoi de l‚Äôe-mail a √©chou√©.\n" +
              "V√©rifiez la configuration EmailJS ou r√©essayez plus tard."
            );
          });
      }

      // --- Rattachement des boutons ---
      const btnWord  = document.getElementById("btn-export-word");
      const btnEmail = document.getElementById("btn-send-email");

      if (btnWord) {
        btnWord.addEventListener("click", exportToWord);
      }
      if (btnEmail) {
        btnEmail.addEventListener("click", sendByEmail);
      }
    })();
  </script>

  <script src="assets/js/mwtd-menu.js"></script>
  <script src="assets/js/mwtd-accessibility.js"></script>
  <script src="assets/js/mwtd-theme.js"></script>
  <script src="assets/js/mwtd-tts.js"></script>
</body>
</html>
